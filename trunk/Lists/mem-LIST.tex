%%%%%
%%
%% This file sets up the Mem, MemFold, and MemEnvelope datatypes, and
%% creates possible macros for each.
%%
%% The Mem datatype isn't really used directly; it's there so the
%% other datatypes can inherit and share its code.
%%
%%%%%

\DECLARESUBTYPE{Mem}{Element}
\PRESETS{Mem}{
  %% \MYname is the trigger
  \F\MYtext	%%  text
  }


%%%%%
%% MemFold and MemEnvelope are both subtypes of Mem.  MemFold is for
%% fold-n-staple style mempackets, MemEnvelope is for stuff-n-seal
%% style mempackets.  If you want a mempacket to contain interesting
%% contents, like sheets, abilities, and other mempackets, use a
%% MemEnvelope.
\DECLARESUBTYPE{MemFold}{Mem}
\DECLARESUBTYPE{MemEnvelope}{Mem}


%%%%%
%% MemCover and MemPage are for the cover and pages of mempacket
%% booklets, which resemble research notebooks.  These are good
%% substitutes for large piles of MemFolds, and can be useful for
%% things like amnesiac characters.
%%
%% Like MemFolds, MemPages shouldn't directly own any other elements
%% as contents.  Use MemEnvelope instead.
%%
%% MemPages are usually assigned to a MemCover (via \MYmems), with the
%% MemCover representing the entire booklet and assigned to a
%% character.
%%
%% A MemCover is not a mempacket in and of itself; its name is not its
%% trigger and its text is not a memory.
\DECLARESUBTYPE{MemCover}{Mem}
\PRESETS{MemCover}{
  \sd\MYtext	{Each page is a memory/event packet with a separate
		trigger.}
  }

\DECLARESUBTYPE{MemPage}{Mem}


%%%%%
%% \memfold{<trigger>}{<text>}
%% \memenvelope{<trigger>}{<text>}
%% \memcover{<name>}{<pages>}
%% \mempage{<trigger>}{<text>}
%% \startmembook{<name>} <pages> \endmembook
%%
%% These are wrappers around \INSTANCE, useful as 1-shots.
%% \startmembook...\endmembook is a simple wrapper around \memcover
%% that may have better syntax for use within character sheets (inside
%% a \starttag{mems}...\endtag block).
\newinstance{MemFold}{\memfold[2]}{
  \s\MYname{#1}\s\MYtext{#2}}
\newinstance{MemEnvelope}{\memenvelope[2]}{
  \s\MYname{#1}\s\MYtext{#2}}
\newinstance{MemCover}{\memcover[2]}{
  \s\MYname{#1}\s\MYmems{#2}}
\newinstance{MemPage}{\mempage[2]}{
  \s\MYname{#1}\s\MYtext{#2}}

\long\def\startmembook#1#2\endmembook{\memcover{#1}{#2}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\NEW{MemFold}{\mTest}{
  \s\MYname	{Test Trigger}
  \s\MYtext	{This is a Test of a fold-n-staple memory packet}
  }

  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%Potions
\NEW{MemFold}{\mLatentPoisonEffect}{
  \s\MYname	{Open immediately once you return to game.}
  \s\MYtext	{You have been poisoned! You are slightly nauseous, now mute, and will die in 5 minutes if you do not receive medical attention or consume a healing potion. If you do either of these things, you are cured-- you won't die and are no longer mute.}
  }

\NEW{MemFold}{\mDeadlyPoisonEffect}{
  \s\MYname	{Open immediately once you return to game.}
  \s\MYtext	{You have been poisoned! The poison is very powerful and will kill you in 10 minutes. Since you are moderately nauseous, your CR drops to zero (and cannot be increased) and you must walk heel to toe. Only an exceptionally powerful magical artifact (\iWishingStone{\MYnumber}) can save you.}
  }

%%Willow's Mem-notebook
\NEW{MemCover}{\mExplosion}{
  \s\MYname	{$\alpha$ Packet}
  \s\MYmems	{\mExplosionPageOne{}\mExplosionPageTwo{}\mExplosionPageThree{}\mExplosionPageFour{}\mExplosionPageFive{}\mExplosionPageSix{}\mExplosionPageSeven{}}
  }

\NEW{MemPage}{\mExplosionPageOne}{
  \s\MYname	{Open when 30 minutes pass in game.}
  \s\MYtext	{Go “not here” for 5 minutes. You can still hear and see everything around you, but cannot interact with it in any way. At the end of this time, increase your $\alpha$ score by 1.}
  }

\NEW{MemPage}{\mExplosionPageTwo}{
  \s\MYname	{Open when 1 hour passes in game.}
  \s\MYtext	{Go mute for 10 minutes. At the end of this time, increase your $\alpha$ score by 1.}
  }

\NEW{MemPage}{\mExplosionPageThree}{
  \s\MYname	{Open when 1.5 hours pass in game.}
  \s\MYtext	{You go blind for 2 minutes. You can blink your eyes open long enough to find a wall, but after that you must keep your eyes closed for 2 minutes.}
}

\NEW{MemPage}{\mExplosionPageFour}{
  \s\MYname	{Open when the banquet starts}
  \s\MYtext	{A group of friendly spirits that only you can see appear out of thin air and smile down at you. You can use them to heal any wounded person or to break any attack based restraint with a 30-count, after which they are totally fine. You can use this ability on yourself or someone else even if you are restrained or wounded yourself. Increase your alpha by 1.}
}

\NEW{MemPage}{\mExplosionPageFive}{
  \s\MYname	{Open when 2.5 hours pass in game.}
  \s\MYtext	{The friendly spirits have turned into demons dripping with blood! They’re out to kill you. run! Roleplay accordingly. If you are forced to stop moving (remember your run away ability), you are knocked out. After a minute, the ghosts dissipate. Increase your alpha by 1. }
}

\NEW{MemPage}{\mExplosionPageSix}{
  \s\MYname	{Open when 3 hours pass in game.}
  \s\MYtext	{Bolts of purple fire stream from your eyes and perform a CR 5 wound attack on the first two people you see (unassistable). If you can’t see two people, run around until you do. Tell people out of game that this is clearly beyond your control. Increase your alpha by 1.

This is really serious. You need to find help for these people, and help for yourself, fast.}
}

\NEW{MemPage}{\mExplosionPageSeven}{
  \s\MYname	{Open when 3.5 hours pass in game.}
  \s\MYtext	{You explode in a burst of radiant fireballs. You wound everyone within 3 ZOC of you (this is not considered combat, and cannot be resisted). Your body doesn’t exist anymore, so carry all of your items out of game and fill out a death report.}
}